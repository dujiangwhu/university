Ext.define('KitchenSink.view.enrollmentManagement.applicationForm.auditApplicationFormPanel', {    extend: 'Ext.panel.Panel',    xtype: 'auditApplicationForm',    controller: 'auditApplicationForm',    requires: [        'Ext.data.*',        'Ext.grid.*',        'Ext.util.*',        'Ext.toolbar.Paging',        'Ext.ux.ProgressBarPager',        'KitchenSink.view.enrollmentManagement.applicationForm.dynamicInfo.dynamicAttributeForm',        'KitchenSink.view.enrollmentManagement.applicationForm.auditApplicationFormController',        'KitchenSink.view.enrollmentManagement.applicationForm.auditFormFileCheckStore',        'KitchenSink.view.enrollmentManagement.applicationForm.referenceLetterStore',        'KitchenSink.view.enrollmentManagement.applicationForm.LcJgStore',        'KitchenSink.view.enrollmentManagement.applicationForm.fileStore'    ],    title: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_STU_STD.auditApplicationForm","报名表审核"),    bodyStyle:'overflow-y:auto;overflow-x:hidden',    constructor: function (obj){        this.appInsID=String(obj.appInsID);        this.applicationFormTagStore=obj.applicationFormTagStore;        this.gridRecord=obj.gridRecord;        this.appAutoTagsStore = obj.appAutoTagsStore;        this.callParent();    },    initComponent: function(){    	Ext.util.CSS.createStyleSheet(" .readOnly-tagfield-cls div {background:#eee;}","readOnly-tagfield-cls");    	        var me = this;        var applicationFormTagStore=this.applicationFormTagStore;        var appAutoTagsStore = this.appAutoTagsStore;        var auditApplicationFormPanel = {            auditFormFileCheckAuditStateStore:new KitchenSink.view.common.store.appTransStore("TZ_BMB_DJWJSPZT"),            auditRefLetterStateStore:new KitchenSink.view.common.store.appTransStore("TZ_APPFORM_STATE"),            auditFormFileCheckBackMsgStore :new KitchenSink.view.common.store.comboxStore({                recname:'TZ_CLS_HFDY_T',                condition:{TZ_CLASS_ID:{                    value:'',                    operator:'01',                    type:'01'                },TZ_SBMINF_ID:{                    value:'',                    operator:'01',                    type:'01'                }},                result:'TZ_SBMINF_REP'            }),            colorSortStore :new KitchenSink.view.common.store.comboxStore({                recname:'TZ_FORM_COLOR_V',                condition:{TZ_JG_ID:{                    value:Ext.tzOrgID,                    operator:'01',                    type:'01'                },TZ_APP_INS_ID:{                    value:String(this.appInsID),                    operator:'01',                    type:'01'                }},                result:'TZ_COLOR_SORT_ID,TZ_COLOR_NAME,TZ_COLOR_CODE'            })        };        Ext.apply(this,{            auditApplicationFormPanel:auditApplicationFormPanel,            items: [                {                    xtype: 'form',                    reference: 'auditApplicationForm',                    layout: {                        type: 'vbox',                        align: 'stretch'                    },                    border: false,                    bodyPadding: 10,                    //heigth: 600,                    bodyStyle:'overflow-y:auto;overflow-x:hidden',                    fieldDefaults: {                        msgTarget: 'side',                        labelWidth: 100,                        labelStyle: 'font-weight:bold'                    },                    items: [{                        xtype: 'textfield',                        name: 'classID',                        hidden:true                    },{                        xtype: 'textfield',                        name: 'oprID',                        hidden:true                    },{                        xtype: 'textfield',                        name: 'remark',                        hidden:true                    },{                        xtype: 'textfield',                        fieldLabel: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.name","姓名"),                        name: 'stuName',                        cls:'lanage_1',                        readOnly:true                    }, {                        xtype: 'textfield',                        fieldLabel: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.className","班级名称"),                        name: 'className',                        cls:'lanage_1',                        readOnly:true                    },{                        xtype: 'textfield',                        fieldLabel: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.appInsID","报名表编号"),                        name: 'appInsID',                        cls:'lanage_1',                        readOnly:true,                        beforeBodyEl: [                            '<li id="{id}-viewAppFormEl" data-ref="viewAppFormEl" class="x-tagfield-item x-tagfield-item-selected" style="cursor:pointer;margin-top:4px;position:absolute">' +                                '<div  class="'+                                'x-tagfield-item-text" style="padding-right:4px;">'+Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.viewApplicationForm","查看报名表")+'</div>' +                                '</li>'                        ],                        childEls: [                            'viewAppFormEl'                        ],                        listeners:{                            change:function(field){                                var appInsID = field.getValue();                                if(appInsID){                                    var length = appInsID.length;                                    if(length>0){                                        var viewAppFormEl = this.viewAppFormEl;                                        if (viewAppFormEl) {                                            var tpl = Ext.create('Ext.XTemplate',                                                'margin-left: {width}px;'                                            );                                            var data = {                                                width: 34+length*8                                            };                                            var marginLeftStyle = tpl.apply(data);                                            viewAppFormEl.applyStyles(marginLeftStyle);                                            viewAppFormEl.addListener("click","viewApplicationForm");                                        }                                    }                                }                            }                        }                    }, {                        xtype: 'combobox',                        fieldLabel: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.appFormState","报名表状态"),                        editable:false,                        name: 'appFormState',                        emptyText:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.pleaseSelect","请选择..."),                        valueField: 'TValue',                        displayField: 'TSDesc',                        store: new KitchenSink.view.common.store.appTransStore("TZ_APPFORM_STATE") ,                        queryMode: 'local',                        triggerAction: 'all'                    }, {                        xtype: 'combobox',                        fieldLabel: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.auditState","评审状态"),                        name: 'auditState',                        editable:false,                        emptyText:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.pleaseSelect","请选择..."),                        valueField: 'TValue',                        displayField: 'TSDesc',                        store: new KitchenSink.view.common.store.appTransStore("TZ_AUDIT_STATE"),                        queryMode: 'local',                        triggerAction: 'all'                    }, {                        xtype: 'tagfield',                        fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.tag","标签"),                        name: 'tag',                        store:applicationFormTagStore,                        valueField: 'TZ_LABEL_ID',                        displayField: 'TZ_LABEL_NAME',                        filterPickList:true,                        createNewOnEnter: true,                        createNewOnBlur: true,                        queryMode: 'local',                        listeners:{                            'select': function(combo,record,index,eOpts)//匹配下拉值之后置空输入文字                            {                                var me = this;                                me.inputEl.dom.value = "";                            }                        }                    }, {                        xtype: 'combobox',                        fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.colorType","类别"),                        name: 'colorType',                        emptyText:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.pleaseSelect","请选择..."),                        queryMode:'local',                        valueField: 'TZ_COLOR_SORT_ID',                        displayField: 'TZ_COLOR_NAME',                        triggerAction: 'all',                        triggers:{                            clear: {                                cls: 'x-form-clear-trigger',                                handler: function(field){                                    field.setValue("");                                }                            }                        },                        editable : false,                        fieldStyle:"padding-left: 46px;",                        store:auditApplicationFormPanel.colorSortStore,                        tpl: Ext.create('Ext.XTemplate',                            '<tpl for=".">',                            '<div class="x-boundlist-item"><div class="x-colorpicker-field-swatch-inner" style="margin-top:6px;width:30px;height:50%;background-color: #{TZ_COLOR_CODE}"></div><div style="margin-left:40px;display: block;  overflow:  hidden; white-space: nowrap; -o-text-overflow: ellipsis; text-overflow:  ellipsis;"> {TZ_COLOR_NAME}</div></div>',                            '</tpl>',{}                        ),                        displayTpl: Ext.create('Ext.XTemplate',                            '<tpl for=".">',                            '{TZ_COLOR_NAME}',                            '</tpl>'                        ),                        beforeBodyEl: [                            '<div class="' + Ext.baseCSSPrefix + 'colorpicker-field-swatch" style="margin-left:110px;width:30px;height:50%">' +                                '<div id="{id}-colorEl" data-ref="colorEl" class="' + Ext.baseCSSPrefix +                                'colorpicker-field-swatch-inner"></div>' +                                '</div>'                        ],                        childEls: [                            'colorEl'                        ],                        listeners:{                            change:function(combo, newValue, oldValue, eOpts){                                var colorEl = this.colorEl;                                if(newValue){                                    var rec = auditApplicationFormPanel.colorSortStore.find('TZ_COLOR_SORT_ID',newValue,0,true,true,false);                                    if(rec>-1){                                        var color = auditApplicationFormPanel.colorSortStore.getAt(rec).get("TZ_COLOR_CODE");                                        if (colorEl) {                                            var tpl = Ext.create('Ext.XTemplate',                                                'background: #{alpha};'                                            );                                            var data = {                                                alpha: color                                            }                                            var bgStyle = tpl.apply(data);                                            colorEl.applyStyles(bgStyle);                                        }                                    }                                }else{                                    colorEl.applyStyles( 'background: none');                                }                            }                        }                    },{                        xtype: 'tagfield',                        fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.autoTags","自动标签"),                        name: 'autoTags',                        store: appAutoTagsStore,                        valueField: 'TZ_ZDBQ_ID',                        displayField: 'TZ_ZDBQ_NAME',                        queryMode: 'local',                        selectOnFocus: false,                        forceSelection: false,                        editable: false,                        readOnly: true,                        cls:'readOnly-tagfield-cls'                    }]                },{                    xtype: 'tabpanel',                    frame: true,                    activeTab: 0,                    plain:false,                    style:'margin:0 10px 0 10px',                    resizeTabs:true,                    defaults :{                        autoScroll: false                    },                    listeners:{                        tabchange:function(tabPanel, newCard, oldCard){                            var queryType;                            var form = tabPanel.findParentByType('auditApplicationForm').child('form').getForm();                            var classID = form.findField('classID').getValue();                            var oprID = form.findField('oprID').getValue();                                                        var appInsID=form.findField('appInsID').getValue();                            if (newCard.name == "fileCheckGrid"){                                queryType = "FILE";                            }                            if (newCard.name == "LcJgGrid"){                                queryType = "BMLC";                            }                            if (newCard.name == "refLetterAndAttachment"){                            }                            if (newCard.name == "remarkForm"){                                /*备注信息*/                            }else if(newCard.name == "moreInfoForm"){                                /*加载更多信息*/                            }else if(newCard.name == "contactInfoForm"){                                /*报名人联系方式*/                            }else{                                var tzStoreParams                                if (newCard.name == "refLetterAndAttachment"){                                    var refLetterStore = newCard.down('grid[name=refLetterGrid]').store;                                    var fileStore = newCard.down('grid[name=fileGrid]').store;                                    if(!refLetterStore.isLoaded()){                                        tzStoreParams = '{"classID":"'+classID+'","oprID":"' + oprID + '","queryType":"REFLETTER"}';                                        refLetterStore.tzStoreParams = tzStoreParams;                                        refLetterStore.load();                                    }                                    if(!fileStore.isLoaded()){                                        tzStoreParams = '{"classID":"'+classID+'","oprID":"' + oprID + '","queryType":"ATTACHMENT"}';                                        fileStore.tzStoreParams = tzStoreParams;                                        fileStore.load();                                    }                                }else if(newCard.name =="KsdrInfoForm")                                	                                	//if(newCard.name == "LcJgGrid")                              /*  {                                    var store = newCard.store;                                    if(!store.isLoaded()){                                        tzStoreParams = '{"classID":"'+classID+'","oprID":"' + oprID + '","queryType":"' + queryType + '"}';                                        store.tzStoreParams = tzStoreParams;                                        store.load();                                  }                                                                      }*/                                	{                          						var tz_params='{"ComID":"TZ_UM_USERMG_COM","PageID":"TZ_UM_MSHLCH_STD","OperateType":"DYITEMS","comParams":{"CLASSID":"'+classID+'","OPRID":"'  + oprID + '","appInsID":"' + appInsID + '"}}';                                                						Ext.tzLoad(tz_params,function(response){            							var items=response;            							//先移除再添加,才不会导致累加            							newCard.removeAll();            							newCard.add(items);            							newCard.doLayout();        	                           //console.log(response);        	                                    });                                	                                	                                	}else{                                    var store = newCard.store;                                    if(!store.isLoaded()){                                        tzStoreParams = '{"classID":"'+classID+'","oprID":"' + oprID + '","queryType":"' + queryType + '"}';                                        store.tzStoreParams = tzStoreParams;                                        store.load({                                            scope: this,                                            callback: function(records, operation, success) {                                                if(queryType == "FILE")                                                {                                                    auditApplicationFormPanel.auditFormFileCheckBackMsgJsonData =new Array(records.length);                                                }                                            }                                        });                                    }                                }                                this.doLayout();                            }                        }                    },                    items:[                        {                            title: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.remark","备注信息"),                            xtype: 'form',                            reference: 'remarkForm',                            name:'remarkForm',                            autoHeight:true,                            layout: {                                type: 'vbox',                                align: 'stretch'                            },                            border: false,                            bodyStyle:'overflow-x:hidden',                            items: [{                                xtype: 'ueditor',                                name: 'remark',                                model:'normal',                                zIndex: 900                            }]                        },                        {                            title:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.fileCheck","考生资料提交检查"),                            xtype: 'grid',                            autoHeight: true,                            minHeight:250,                            bodyBorder:false,                            columnLines: true,                            viewConfig: {markDirty: false},                            name: 'fileCheckGrid',                            reference: 'fileCheckGrid',                            plugins: {                                ptype: 'cellediting',                                pluginId: 'fileCheckCellEditing',                                clicksToEdit: 1                            },                            store: {                                type: 'auditFormFileCheckStore'                            },                            dockedItems:[{                                xtype:"toolbar",                                items:[                                    {                                        text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.setAuditState","设置审核状态"),iconCls:"set",                                        menu:[                                            {text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.setAllPassed","全部设置为通过"),iconCls:"pass",handler: "setPassed"},                                            {text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.setAllFailed","全部设置为不通过"),iconCls:"fail",handler:'setFailed'},                                            {text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.setAllPending","全部设置为待审核"),iconCls:"pending",handler:'setPending'}                                        ]                                    }                                ]                            },{                                xtype:"toolbar",                                dock: 'bottom',                                items:[                                    {text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.ensureEnrollEmail","确认报名后续工作提醒邮件"),iconCls: "email",handler:'sendFilePassedEmail'},"-",                                    {text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.supplyMaterialsEmail","需补充资料提醒邮件"),iconCls:"email",handler:'sendFileFailedEmail'}                                ]                            }],                            columns: [                                {                                    text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.contentIntro","内容简介"),                                    dataIndex: 'intro',                                    sortable: false,                                    minWidth:150,                                    flex:1                                },{                                    text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.remark","备注"),                                    dataIndex: 'remark',                                    sortable: false,                                    minWidth:150,                                    flex:1                                },{                                    text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.auditState","审核状态"),                                    dataIndex: 'auditState',                                    sortable: false,                                    width:100,                                    editor: {                                        editable:false,                                        xtype:"combo",                                        forceSelection: true,                                        valueField: 'TValue',                                        displayField: 'TSDesc',                                        store: auditApplicationFormPanel.auditFormFileCheckAuditStateStore,                                        queryMode: 'local'                                    },                                    renderer:function(v){                                        if(v){                                            var rec = auditApplicationFormPanel.auditFormFileCheckAuditStateStore.find('TValue',v,0,false,false,true);                                            if(rec>-1){                                                return auditApplicationFormPanel.auditFormFileCheckAuditStateStore.getAt(rec).get("TSDesc");                                            }else{                                                return "";                                            }                                        }else{                                            return "";                                        }                                    }                                },{                                    text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.selectReplyPhrase","选择常用回复短语"),                                    dataIndex: 'phrase',                                    sortable: false,                                    width:150,                                    renderer:function(){                                        return '<a href="javascript:void(0)" style="text-decoration:none;">'+Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.pleaseSelect","请选择...")+'</a>'                                    },                                    editor: {                                        editable:false,                                        xtype:"combo",                                        queryMode:"local",                                        store: {fields: [{name: 'TZ_SBMINF_REP'}],                                            data: [{TZ_SBMINF_REP: ''}],                                            autoLoad: true                                        },                                        forceSelection: true,                                        valueField: 'TZ_SBMINF_REP',                                        displayField: 'TZ_SBMINF_REP',                                        tpl: Ext.create('Ext.XTemplate',                                            '<tpl for=".">',                                            '<div class="x-boundlist-item"><div style="display: block;  overflow:  hidden; white-space: nowrap; -o-text-overflow: ellipsis; text-overflow:  ellipsis;" data-qtip="{TZ_SBMINF_REP}"> {TZ_SBMINF_REP}</div></div>',                                            '</tpl>'                                        ),                                        listeners: {                                            select:function(combo, record, eOpts){                                                var selList = combo.findParentByType("grid").getView().getSelectionModel().getSelection();                                                var gridStore = selList[0].store;                                                var index =gridStore.indexOf(selList[0]);                                                selList[0].set("failedReason",record.get("TZ_SBMINF_REP"));                                                combo.value="";                                            },                                            focus: function (combo,event, eOpts) {                                                var selList = combo.findParentByType("grid").getView().getSelectionModel().getSelection();                                                var gridStore = selList[0].store;                                                var index =gridStore.indexOf(selList[0]);                                                var classID = selList[0].get('classID');                                                var fileID =selList[0].get('fileID');                                                var tzStoreParams ='{"OperateType":"COMBOX","recname":"TZ_CLS_HFDY_T","condition":{"TZ_CLASS_ID":{"value":"'+classID+'","operator":"01","type":"01"},"TZ_SBMINF_ID":{"value":"'+fileID+'","operator":"01","type":"01"}},"result":"TZ_SBMINF_REP"}'                                                var arrayData;                                                if(auditApplicationFormPanel.auditFormFileCheckBackMsgJsonData[index]==undefined){                                                    combo.store.loadData({                                                        TZ_SBMINF_REP: 'Loading...'                                                    });                                                    arrayData = new Array();                                                    auditApplicationFormPanel.auditFormFileCheckBackMsgStore.tzStoreParams=tzStoreParams;                                                    auditApplicationFormPanel.auditFormFileCheckBackMsgStore.load({                                                        scope: this,                                                        callback: function(records, operation, success) {                                                            for(var i=0;i<records.length;i++){                                                                arrayData.push(records[i].data);                                                            }                                                            auditApplicationFormPanel.auditFormFileCheckBackMsgJsonData[index] = arrayData;                                                            combo.store.loadData(arrayData);                                                        }                                                    } );                                                }else{                                                    combo.store.loadData(auditApplicationFormPanel.auditFormFileCheckBackMsgJsonData[index])                                                }                                            }                                        }                                    }                                },{                                    text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.auditFailedReason","审核不通过原因"),                                    dataIndex: 'failedReason',                                    sortable: false,                                    width:150,                                    editor: {                                        xtype:"textfield"                                    }                                }                                ,{                                    menuDisabled: true,                                    sortable: false,                                    width:150,                                    xtype: 'actioncolumn',                                    align:'center',                                    items:[                                        {iconCls: 'set',tooltip: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.setReplyPhrases","常用回复短语设置"),handler:'setBackMsg'}                                    ]                                }                            ]                        },                       //修改考生导入信息                        {        					title : '考生导入信息',        					xtype : 'form',        					name : 'KsdrInfoForm',        					reference:'KsdrInfoForm',        					layout : {        						type : 'vbox',        						align : 'stretch'        					},        					// frame: true,        					border : false,        					bodyPadding : 10,        					// margin:10,        					bodyStyle : 'overflow-y:auto;overflow-x:hidden',        					fieldDefaults : {        						msgTarget : 'side',        						labelWidth : 200,        						readOnly : true,        						fieldStyle : 'background:#F4F4F4',         						labelStyle : 'font-weight:bold'        					},        					items : [         					  ]        				},/*   //刘哲添加流程结果公布---开始           *             {                            title: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.publishProcessResult","流程结果公布"),                            xtype: 'grid',                            autoHeight: true,                            minHeight:250,                            bodyBorder:false,                            columnLines: true,                            viewConfig: {markDirty: false},                            name: 'LcJgGrid',                            reference: 'LcJgGrid',                            plugins: {                                ptype: 'cellediting',                                pluginId: 'fileCheckCellEditing',                                clicksToEdit: 1                            },                            store: {                                type: 'LcJgStore'                            },                            dockedItems:[{                                xtype:"toolbar",                                items:[                                    {                                        text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.viewFrontContent","查看前台公布内容"),                                        iconCls:"view",                                        name:'viewFrontCon',                                        handler: "checkFrontCon"                                    },                                    {                                        html:'<a class="viewFrontCon fancybox.ajax" >&nbsp</a>',                                        hidden:true                                    }                                ],                                listeners:{                                    afterrender:function(toolbar){                                        var form=toolbar.findParentByType('auditApplicationForm').child('form[reference=auditApplicationForm]').getForm();                                        var classID=form.getValues().classID;                                        var oprID=form.getValues().oprID;                                        var tzParams='?tzParams='+encodeURIComponent('{"ComID":"TZ_BMGL_BMBSH_COM","PageID":"TZ_BMGL_AUDIT_STD","OperateType":"HTML","comParams":{"oprId":"'+oprID+'","classId":"' + classID + '"}}');                                        var url = Ext.tzGetGeneralURL() + tzParams;                                        $('.viewFrontCon').attr('href',url);                                        $('.viewFrontCon').fancybox();                                    }                                }                            }],                            columns: [                                {                                    text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.stageName","阶段名称"),                                    dataIndex: 'bmlcName',                                    sortable: false,                                    width:200                                },{                                    text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.result","结果"),                                    minWidth:160,                                    bind: '{color}',                                    dataIndex: 'colorCode',                                    flex: 1,                                    renderer:function(value){                                        var _url1=value.split(",,");                                        return "<div class='x-colorpicker-field-swatch-inner'' style='width:20%;height:50%;background-color: #"+_url1[0]+"'></div><div style='width:75%;margin-left:auto'>"+(_url1[1]?_url1[1]:'&nbsp;')+"</div>";                                    }                                },{                                    xtype:'linkcolumn',                                    text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.setProcessResult","设置流程结果"),                                    width:150,                                    align: 'center',                                    groupable: false,                                    sortable:false,                                    items:[{                                        getText:function(v, meta, rec) {                                            return this.getHeaderAtIndex(meta.columnIndex).text;                                        },                                        handler: "bmlc_edit"                                    }]                                }                            ]                        },*/                        //刘哲添加流程结果公布---结束                        {                            minHeight:250,                            layout: {                                type: 'accordion',                                animate:true                            },                            tabBar: {                                border: false                            },                            title: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.recommendationAndAttachment","推荐信和附件"),                            name:'refLetterAndAttachment',                            items:[                                {                                    title: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.recommendation","推荐信"),                                    xtype: 'grid',                                    columnLines: true,                                    dockedItems:[{                                        xtype:"toolbar",                                        items:[                                            {text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.sendRecommendationSubmitStateEmail","发送推荐信未完全提交提醒邮件"),iconCls:"email",handler: "sendRefLetterRemindEmail"}                                        ]                                    }],                                    name: 'refLetterGrid',                                    reference: 'refLetterGrid',                                    plugins: {                                        ptype: 'cellediting',                                        pluginId: 'refLetterCellEditing',                                        clicksToEdit: 1,                                        listeners:{                                            beforeedit:function(editor, context, eOpts){                                                if(context.record.get('refLetterAppInsId')==0){                                                    return false;                                                }                                            }                                        }                                    },                                    store: {                                        type: 'referenceLetterStore'                                    },                                    columns: [                                        {                                            text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.name","姓名"),                                            dataIndex: 'refLetterPerName',                                            sortable: false,                                            minWidth:90                                        },{                                            text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.email","邮箱"),                                            dataIndex: 'refLetterPerEmail',                                            sortable: false,                                            flex:1,                                            minWidth:120                                        },{                                            text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.mobilePhone","手机"),                                            dataIndex: 'refLetterPerPhone',                                            sortable: false,                                            width:120                                        },{                                            xtype:'linkcolumn',                                            text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.viewRecommendation","查看推荐信"),                                            sortable:false,                                            align:'center',                                            items:[{                                                text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.view","查看"),                                                handler: "viewRefLetter"                                            }],                                            width:105                                        },{                                            text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.submitState","提交状态"),                                            dataIndex: 'refLetterState',                                            sortable: false,                                            width:100,                                            editor: {                                                editable:false,                                                xtype:"combo",                                                forceSelection: true,                                                valueField: 'TValue',                                                displayField: 'TSDesc',                                                store: auditApplicationFormPanel.auditRefLetterStateStore,                                                queryMode: 'local'                                            },                                            renderer:function(v,metadata,record){                                                if(v){                                                    var rec = auditApplicationFormPanel.auditRefLetterStateStore.find('TValue',v,0,false,true,false);                                                    if(rec>-1){                                                        return auditApplicationFormPanel.auditRefLetterStateStore.getAt(rec).get("TSDesc");                                                    }else{                                                        return "";                                                    }                                                }else{                                                    return "";                                                }                                            }                                        },{                                            text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.submitTime","提交时间"),                                            dataIndex: 'refLetterTime',                                            sortable: false,                                            width:120                                        },{                                            text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.recommendation","推荐信"),                                            sortable: true,                                            dataIndex: 'refLetterFile',                                            minWidth: 150,                                            flex:1,                                            renderer:function(value,metadata,record){                                                var refLetterSysFile = record.get('refLetterSysFile');                                                var refLetterUserFile = record.get('refLetterUserFile');                                                var refAccessUrl = record.get('refLetterAurl');                                                if (refLetterSysFile == "" || refLetterSysFile == null	|| refAccessUrl == "" || refAccessUrl == null){                                                    return Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.recommendation","推荐信");                                                }else{                                                    return '<a href="'+ TzUniversityContextPath + refAccessUrl+'" target="_blank">'+refLetterUserFile+'</a>';                                                }                                            }                                        },{                                            menuDisabled: true,                                            sortable: false,                                            width:60,                                            xtype: 'actioncolumn',                                            align: 'center',                                            items:[                                                {iconCls: 'upload',tooltip: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.upload","上传"), handler: 'uploadRefLetter'},                                                {iconCls: 'remove',tooltip: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.delete","删除"), handler: 'deleteRefLetter'}                                            ]                                        }                                    ]                                },                                {                                    title:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.attachment","附件"),                                    xtype: 'grid',                                    columnLines: true,                                    name: 'fileGrid',                                    reference: 'fileGrid',                                    dockedItems:[{                                        xtype:"toolbar",                                        items:[                                            {text:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.uploadfile","上传附件"),iconCls:"upload",handler: "uploadFiles"}                                        ]                                    }],                                    store: {                                        type: 'uploadFilesStore'                                    },                                    plugins: {                                        ptype: 'cellediting',                                        pluginId: 'attachmentCellEditing',                                        clicksToEdit: 1                                    },                                    listeners:{                                        viewready:function(panel){                                            panel.store.findBy(function(record,id){                                                var itemID = record.get('xuhao');                                                $("a[ref="+itemID+"]").fancybox(                                                    {                                                        prevEffect : 'none',                                                        nextEffect : 'none',                                                        closeBtn  : true,                                                        arrows    : false,                                                        nextClick : true,                                                        helpers : {                                                            thumbs : {                                                                width  : 50,                                                                height : 50                                                            },title : {                                                                type : 'inside'                                                            },                                                            buttons	: {}                                                        }                                                    }                                                );                                            })                                        }                                    },                                    store: {                                        type: 'fileStore'                                    },                                    columns: [{                                        text: "fancyboxId",                                        dataIndex: 'xuhao',                                        hidden:true                                    },{                                        text: "信息项ID",                                        dataIndex: 'TZ_XXX_BH',                                        hidden:true                                    },{                                        text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.attachmentName","附件名称"),                                        dataIndex: 'TZ_XXX_MC',                                        minWidth:425                                    },{                                        text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.viewAttachment","查看附件"),                                        dataIndex: 'fileLinkName',                                        minWidth:  200,                                        flex: 1,                                        renderer: function(value,metadata,record) {                                            var strFile = record.get('strfileDate');                                            return strFile;                                        }                                    },{                                        menuDisabled: true,                                        sortable: false,                                        width:60,                                        xtype: 'actioncolumn',                                        text: '操作',                                        align: 'center',                                        items:[                                            {iconCls: 'remove',tooltip:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.delete","删除"), handler: 'deleteFiles'}                                        ]                                    }                                    ]                                }                            ]                        },                        {                            title: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.contactInfo","报名人联系方式"),                            xtype: 'form',                            reference: 'contactInfoForm',                            name: 'contactInfoForm',                            autoHeight:true,                            layout: {                                type: 'vbox',                                align: 'stretch'                            },                            border: false,                            bodyPadding: 10,                            fieldDefaults: {                                msgTarget: 'side',                                labelWidth: 110,                                labelStyle: 'font-weight:bold'                            },                            bodyStyle:'overflow-x:hidden',                            items: [{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.mainMobilePhone","主要手机"),                                xtype: 'textfield',                                name: 'mainMobilePhone',                                maxLength:20                            },{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.backupMobilePhone","备用手机"),                                xtype: 'textfield',                                name: 'backupMobilePhone',                                maxLength:20                            },{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.mainPhone","主要电话"),                                xtype: 'textfield',                                name: 'mainPhone',                                maxLength:20                            },{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.backupPhone","备用电话"),                                xtype: 'textfield',                                name: 'backupPhone',                                maxLength:20                            },{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.mainEmail","主要邮箱"),                                xtype: 'textfield',                                vtype:'email',                                name: 'mainEmail',                                maxLength:100                            },{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.backupEmail","备用邮箱"),                                xtype: 'textfield',                                vtype:'email',                                name: 'backupEmail',                                maxLength:100                            },{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.mainAddress","主要通讯地址"),                                xtype: 'textfield',                                name: 'mainAddress',                                maxLength:254                            },{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.backupAddress","备用通讯地址"),                                xtype: 'textfield',                                name: 'backupAddress',                                maxLength:254                            },{                                fieldLabel:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.wechat","微信号"),                                xtype: 'textfield',                                name: 'wechat',                                maxLength:20                            },{                                fieldLabel : Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.skype","Skype帐号"),                                xtype: 'textfield',                                name: 'skype',                                maxLength:70                            }                            ]                        },                        {                            title:Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_AUDIT_STD.moreInfo","更多信息"),                            xtype: 'dynamicAttrForm',                            reference: 'moreInfoForm',                            name: 'moreInfoForm',                            appInsID:me.appInsID                        }]                }]        });        this.callParent();    },    buttons: [{        text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_STU_STD.save","保存"),        iconCls:"save",        name:'auditAppFormSaveBtn',        handler: 'onAuditApplicationFormSave'    }, {        text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_STU_STD.ensure","确定"),        iconCls:"ensure",        name:'auditAppFormEnsureBtn',        handler: 'onAuditApplicationFormSave'    }, {        text: Ext.tzGetResourse("TZ_BMGL_BMBSH_COM.TZ_BMGL_STU_STD.close","关闭"),        iconCls:"close",        handler: 'onAuditApplicationFormClose'    }]});