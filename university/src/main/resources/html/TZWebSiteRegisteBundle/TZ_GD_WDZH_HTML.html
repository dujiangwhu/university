<script type="text/javascript">
	var tzGdWdzhSaveActivateUrl = '%bind(:1)';
	var tzGdWdzhPhotoUrl = '%bind(:2)';
	var tzGdWdzhChangeEmailUrl = '%bind(:4)';
	var tzGdWdzhChangeMobileUrl = '%bind(:5)';
	var tzGdWdzhGetUserInfo = '%bind(:8)';
	var tzGdWdzhSaveRemind = '%bind(:9)';
	var tzGdWdzhProvUrl = '%bind(:11)';
	var tzGdWdzhCityUrl = '%bind(:12)';
	var tzGdWdzhDoBind = "%bind(:20)";
	var tzGdWdzhReleaseBind = "%bind(:21)";
	var tzGdWdzhAbsence = "%bind(:22)";
	var tzGdWdzhPassSucTips = "%bind(:23)";
	var tzGdWdzhCountryUrl = '%bind(:24)';
	
	function uploadAttachment() {
		 var path = $("#"+TZ_TEA_UP).val();
		 if(path){
			//文件名
			filename = path.substring(path.lastIndexOf("\\") + 1,path.length);
			//文件后缀
			var sysfileSuffix = (filename.substring(filename.lastIndexOf(".") + 1)).toLowerCase();
			var allowFileType = "jpg,png,jpeg";
			var allowSize = 10;
			//允许上传的文件类型
			var typeArr = allowFileType.split(",");
			var isAllow = false;
			if (sysfileSuffix && allowFileType != "" && typeArr.length > 0){
				for(var i=0; i<typeArr.length; i++){
						if(sysfileSuffix == typeArr[i].toLowerCase()){
							isAllow = true;
							break;
						}}
					if(!isAllow){
						var formatMsg = MsgSet["FILETYPE"].replace("【TZ_FILE_TYPE】",allowFileType);
						//formatMsg = formatMsg.substring(0,formatMsg.length-1);
						alert(formatMsg+"!");
						return;	
					}
				}
				//最多只能上传10个附件
				if(_children.length >= 10){
					alert(MsgSet["FILE_COUNT"])
					return;
				}

				try{
					loading();/*上传进度条*/
					var $form = document.getElementById("main_list");
					$form.encoding = "multipart/form-data";
					var tzParam = "?filePath=appFormAttachment&keyName=" + $(el).attr("name") + "&" + Math.random();
					$form.action = TzUniversityContextPath + "/SingleUpdWebServlet" + tzParam;
					$("#main_list").ajaxSubmit({
						dataType:'json',
						type:'POST',
						url:TzUniversityContextPath + "/SingleUpdWebServlet" + tzParam,
						success: function(obj) {
							if(obj.success){
								//清空file控件的Value
								if(isIE = navigator.userAgent.indexOf("MSIE")!=-1) { //IE浏览器
									var file = $("#"+itemId); 
									file.after(file.clone().val("")); 
									file.remove(); 
									
									var $fileInput = $("#"+itemId);
									var $uplBtn = $fileInput.prev(".bt_blue");
									$fileInput.mousemove(function(e){
										$uplBtn.css("opacity","0.8");	
									});
									$fileInput.mouseout(function(e) {
										$uplBtn.css("opacity","1");
									});
								} else {//非IE浏览器
									$("#"+itemId).val("");	
								}
								
								var fileSize = obj.msg.size;
								fileSize = fileSize.substring(0,fileSize.length-1);
								if(allowSize !="" && fileSize/1024 > allowSize){
									layer.close(layer.index);/*关闭上传进度条*/
									alert(MsgSet["FILE_SIZE_CRL"].replace("【TZ_FILE_SIZE】",allowSize));
								} else {
									this.is_edit = true;
									var maxOrderBy;
									if (multiFlag == "Y"){
										maxOrderBy = _children[_children.length-1].orderby;//已存在最大顺序编号
									} else {
										maxOrderBy = 0;
									}
									//上传成功后将文件存储到数据库
									var _Url = SurveyBuild.tzGeneralURL + "?tzParams=";
									var param = '{"ComID":"TZ_GD_FILEUPD_COM","PageID":"TZ_GD_FILEUPD_STD","OperateType":"EJSON","comParams":{"tz_app_ins_id":"'+appInsId+'","itemId":"'+itemId+'","itemName":"'+SurveyBuild.specialCharReplace(itemName)+'","filename":"'+obj.msg.filename+'","sysFileName":"'+obj.msg.sysFileName+'","maxOrderBy":"'+maxOrderBy+'","dhIndex":"'+index+'","refLetterId":"'+refLetterId+'"}}';
									$.ajax({
										type: "post",
										url: _Url + encodeURIComponent(param), 									
										dataType: "json",
										async: false,
										success: function(rst){
											var state = rst.state;
											var rstObj = rst.comContent;
											if(state.errcode == 0){
												if(rstObj.result="success"){
													var c = "";
													if(multiFlag == "Y"){
														if (_children.length == 1 && _children[0].fileName == ""){
															_children[0].fileName = rstObj.fileName;
															_children[0].sysFileName = rstObj.sysFileName;
															_children[0].orderby = rstObj.index;
															_children[0].accessPath = obj.msg.accessPath;
															_children[0].viewFileName = rstObj.viewFileName;
														} else {
															_fc = cloneObj(_children[0]);
															_fc["itemId"] += "_"+rstObj.index;
															_fc["itemName"] += "_"+rstObj.index;
															_fc["fileName"] = rstObj.fileName;
															_fc["sysFileName"] = rstObj.sysFileName;
															_fc["orderby"] = rstObj.index;
															_fc["accessPath"] = obj.msg.accessPath;
															_fc["viewFileName"] = rstObj.viewFileName;
															_children.push(_fc);
														}
														if (className == "imagesUpload"){
									        				c += '<div class="input-list-uploadcon-list">';
									        				c += '	<div class="input-list-uploadcon-listl left"><a class="input-list-uploadcon-list-a" onclick=SurveyBuild.viewImageSet(this,"' + instanceId + '") file-index="' + rstObj.index + '">' + rstObj.viewFileName + '</a></div>';
									        				/*c += '	<div class="input-list-uploadcon-listr left"><button class="upload-del" onclick="SurveyBuild.deleteFile(this,\'' + instanceId + '\')">' + MsgSet["DEL"] + '</button></div>';*/
															c += '<div class="input-list-uploadcon-listr left" style="display: inline-block;line-height:46px;" onclick="SurveyBuild.deleteFile(this,\'' + instanceId + '\')"><img src="' + TzUniversityContextPath + '/statics/images/appeditor/del.png" title="' + MsgSet["DEL"] + '"/>&nbsp;</div>';
									        				c += '	<div class="clear"></div>';
									        				c += '</div>';
														} else {
								        	   				c += '<div class="input-list-uploadcon-list">';
								        	   				c += '	<div class="input-list-uploadcon-listl left">';
								        	   				c += '		<a class="input-list-uploadcon-list-a" onclick=SurveyBuild.downLoadFile(this,"' + instanceId + '") file-index = "' + rstObj.index + '">' + rstObj.viewFileName + '</a>';
								        	   				if(sysfileSuffix == "pdf" && isOnlineShow == "Y"){
								        	   					c += '<div class="input-list-uploadcon-list-pdf" onclick="SurveyBuild.PDFpreview(this,\'' + instanceId + '\')" file-index = "' + rstObj.index + '">&nbsp;&nbsp;<img src="' + TzUniversityContextPath + '/statics/images/appeditor/preview.png" title="' + MsgSet["PDF_VIEW"] + '"/>&nbsp;</div>';
								        	   				}
								        	   				c += '	</div>';
								        	   				/*c += '	<div class="input-list-uploadcon-listr left"><button class="upload-del" onclick="SurveyBuild.deleteFile(this,\"' + instanceId + '\")">' + MsgSet["DEL"] + '</button></div>';*/
															c += '<div class="input-list-uploadcon-listr left" style="display: inline-block;line-height:46px;" onclick="SurveyBuild.deleteFile(this,\'' + instanceId + '\')"><img src="' + TzUniversityContextPath + '/statics/images/appeditor/del.png" title="' + MsgSet["DEL"] + '"/>&nbsp;</div>';
								        	   				c += '	<div class="clear"></div>';
								        	   				c += '</div>';
														}
														$("#"+itemId+"_AttList").append(c);
													}else{
														_children[0].fileName = rstObj.fileName;
														_children[0].sysFileName = rstObj.sysFileName;
														_children[0].orderby = rstObj.index;
														_children[0].accessPath = obj.msg.accessPath;
														_children[0].viewFileName = rstObj.viewFileName;
														if (className == "imagesUpload"){
									        				c += '<div class="input-list-uploadcon-list">';
									        				c += '	<div class="input-list-uploadcon-listl left"><a class="input-list-uploadcon-list-a" onclick=SurveyBuild.viewImageSet(this,"' + instanceId + '") file-index="' + rstObj.index + '">' + rstObj.viewFileName + '</a></div>';
									        				/*c += '	<div class="input-list-uploadcon-listr left"><button class="upload-del" onclick="SurveyBuild.deleteFile(this,\'' + instanceId + '\')">' + MsgSet["DEL"] + '</button></div>';*/
															c += '<div class="input-list-uploadcon-listr left" style="display: inline-block;line-height:46px;" onclick="SurveyBuild.deleteFile(this,\'' + instanceId + '\')"><img src="' + TzUniversityContextPath + '/statics/images/appeditor/del.png" title="' + MsgSet["DEL"] + '"/>&nbsp;</div>';
									        				c += '	<div class="clear"></div>';
									        				c += '</div>';
														} else {
								        	   				c += '<div class="input-list-uploadcon-list">';
								        	   				c += '	<div class="input-list-uploadcon-listl left">';
								        	   				c += '		<a class="input-list-uploadcon-list-a" onclick=SurveyBuild.downLoadFile(this,"' + instanceId + '") file-index = "' + rstObj.index + '">' + rstObj.viewFileName + '</a>';
								        	   				if(sysfileSuffix == "pdf" && isOnlineShow == "Y"){
								        	   					c += '<div class="input-list-uploadcon-list-pdf" onclick="SurveyBuild.PDFpreview(this,\'' + instanceId + '\')" file-index = "' + rstObj.index + '">&nbsp;&nbsp;<img src="' + TzUniversityContextPath + '/statics/images/appeditor/preview.png" title="' + MsgSet["PDF_VIEW"] + '"/>&nbsp;</div>';
								        	   				}
								        	   				c += '	</div>';
								        	   				/*c += '	<div class="input-list-uploadcon-listr left"><button class="upload-del" onclick="SurveyBuild.deleteFile(this,\"' + instanceId + '\")">' + MsgSet["DEL"] + '</button></div>';*/
															c += '<div class="input-list-uploadcon-listr left" style="display: inline-block;line-height:46px;" onclick="SurveyBuild.deleteFile(this,\'' + instanceId + '\')"><img src="' + TzUniversityContextPath + '/statics/images/appeditor/del.png" title="' + MsgSet["DEL"] + '"/>&nbsp;</div>';
								        	   				c += '	<div class="clear"></div>';
								        	   				c += '</div>';
														}
														$("#"+itemId+"_AttList").html(c);
													}
													//提示隐藏
													var $errorTip = $("#"+itemId+"Tip");
													if ($errorTip.hasClass("onError")){
														$errorTip.removeClass().addClass("onCorrect");
														$errorTip.children("div").removeClass().addClass("onCorrect");	
														$errorTip.children("div").attr("tips","");
													}
												}else{
													alert(rst.resultDesc);
												}
											}else{
												alert(state.errdesc);
											}
										}
									})
									layer.close(layer.index);/*关闭上传进度条*/
								}
							}else{
								noteing(MsgSet["FILE_UPL_FAILED"], 2);
								layer.close(layer.index);/*关闭上传进度条*/
							}
						}
					});
				}catch(e){
					alert(e);
				}
			} 
	}
</script>
<script type="text/javascript"
	src="%bind(:27)/statics/js/tranzvision/func/custom_radio.js"></script>
<script type="text/javascript"
	src="%bind(:27)/statics/js/lib/laydate/laydate.js"></script>
<script type="text/javascript"
	src="%bind(:27)/statics/js/tranzvision/util/layer.js"></script>
<script type="text/javascript"
	src="%bind(:27)/statics/js/website/account/wdzh.js"></script>
<!-- content start -->
<div class="main_inner">
	<div class="main_inner_title">
		<div class="main_inner_title_text_wide">%bind(:13)</div>
	</div>
	<div class="mian_inner_nav" id="tab1">
		<div class="float_left">
			<ul>
				<li class="now" onclick="setTab(1,0)">%bind(:14)</li>
				<li onclick="setTab(1,1)">%bind(:15)</li>
				<!-- <li onclick="setTab(1,2)">%bind(:17)</li> -->
				<!-- Hello World LDD TEST-->
				<!--<li onclick="setTab(1,3)">%bind(:16)</li> -->
			</ul>
		</div>
	</div>
	<div id="content1">
		<div class="tab1 block">
			<div class="main_inner_left">
				<!-- 甯澶村html-->
				<div onmousemove="tz_onmousemove();" onmouseout="tz_onmouseout();"
					class="main_mid_info_photo"
					style="float: none; position: relative; margin: 0 auto; text-align: center">
					<a onclick="openUpload2();"><img src="%bind(:26)" width="126"
						height="158" id="photo">
						<div id="tz_edituser"
							style="position: absolute; z-index: 2; left: 0px; top: 130px; display: none;">
							<img src="%bind(:25)"
								style="filter: alpha(opacity = 30); -moz-opacity: 0.7; opacity: 0.7; -khtml-opacity: 0.7;"
								width="126" height="28" id="photo2">
						</div> </a>
				</div>
				<!--<div class="main_article_nav">
						<div class="center_bt">
					    	<div id="saveInfo" class="bt_blue" onclick="openUpload()">%bind(:18)</div>
					    </div>
					</div>-->
			</div>
			<div class="main_inner_right">
				<input type="hidden" id="ParamCon" /> <input type="hidden"
					id="ParamValue" /> %bind(:10)
			</div>
			<div class="main_all_line_center"></div>
			<div class="main_article_nav">
				<div class="center_bt">
					<div id="saveper" class="bt_blue">%bind(:19)</div>
				</div>
			</div>
			<div class="padding_div_50px"></div>
		</div>
		<div class="tab1">%bind(:3)</div>
		<div class="tab1">%bind(:7)</div>
		<!--<div class="tab1">%bind(:6)</div>-->
	</div>
	<div style="clear: both;"></div>
</div>
<!-- content end -->